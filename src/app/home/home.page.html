<ion-header>
  <div class="toolbar">
    <ion-menu-button color="primary"><ion-icon name="menu-outline"></ion-icon></ion-menu-button>
    <h1>markkar</h1>
    <ion-button id="userIconBTN" size="small" expand="block" fill="clear" shape="round"><ion-icon class="userIcon" color="primary" name="person-outline"></ion-icon></ion-button>
  </div>
  <ion-popover [dismissOnSelect]="true" trigger="userIconBTN">
    <ng-template>
      <ion-content>
        <ion-list color="secondary">
          <ion-item color="secondary" (click)="redirect()" [button]="true">
            <ion-label>Opções</ion-label>
          </ion-item >
          <ion-item lines="none" color="secondary" (click)="presentAlertConfirm()" [button]="true">
            <ion-label>Desconectar</ion-label>
          </ion-item>
        </ion-list>
      </ion-content>
    </ng-template>
  </ion-popover>
  <header class="headerSection">
    <div id="totalLiquido">
      <h2 *ngIf="contentLoader">{{somaMargemHeader}}</h2>
      <ion-skeleton-text *ngIf="!contentLoader" animated style="width: 140px; height: 24px;"></ion-skeleton-text>
      <p>margem</p>
    </div>
    <div id="total">
      <div>
        <h3 *ngIf="contentLoader">{{ somaFatHeader }}</h3>
        <ion-skeleton-text *ngIf="!contentLoader" animated style="width: 115px; height: 17px;"></ion-skeleton-text>
        <p>faturamento</p>
      </div>
      <div>
        <h3 *ngIf="contentLoader">{{somaCMVHeader}}{{perc}}</h3>
        <ion-skeleton-text *ngIf="!contentLoader" animated style="width: 80px; height: 17px;"></ion-skeleton-text>
        <p>cmv</p>
      </div>
    </div>
  </header>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed"(ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
  <section class="section">
    <div class="unidades">
      <div class="informacoes">
        <ion-button expand="block" (click)="displayUnidades = !displayUnidades" fill="clear" style="text-transform: uppercase; font-size: 1rem; width: 142px;" shape="round">unidades</ion-button>
        <ion-button id="dateModal" expand="block" fill="clear" style="text-transform: uppercase; width: 142px;" shape="round">filtros<ion-icon style="width: 13px; margin-left: 5px;font-size: 1rem;" name="funnel-outline"></ion-icon></ion-button>
        <ion-popover id="filter" trigger="dateModal">
          <ng-template>
            <ion-content>
              <ion-list color="secondary">
                <ion-item lines="none" color="secondary">
                  <ion-label style="text-transform: none;font-size: 0.9rem;">Intervalo de Faturamento</ion-label>
                  <ion-select value="{{interval}}" interface="popover" (ionChange)="setInterval($event)" placeholder="Selecione">
                    <ion-select-option value="all">Todos</ion-select-option>
                    <ion-select-option value="year">Anual</ion-select-option>
                    <ion-select-option value="month">Mensal</ion-select-option>
                    <ion-select-option value="day">Diario</ion-select-option>
                    <ion-select-option value="interval">Intervalo</ion-select-option>
                  </ion-select>
                </ion-item>
                <ion-accordion-group>
                  <ion-accordion value="inicio" [ngStyle]="{'display': displayInterval}">
                    <ion-item lines="none" color="secondary" slot="header">
                      <ion-label>inicio<p class="p">{{ dateValueInitFormat }}</p></ion-label>
                    </ion-item>

                    <ion-list slot="content">
                      <ion-datetime style="width: 100%;" value="{{dateValueInit}}" locale="pt-BR" #dateTimeInit (ionChange)="dateChangeInit(dateTimeInit.value)" max="{{ maxDate }}" presentation="date"></ion-datetime>
                    </ion-list>
                  </ion-accordion>
                  <ion-accordion value="fim" [ngStyle]="{'display': displayInterval}">
                    <ion-item lines="none" color="secondary"slot="header">
                      <ion-label>fim<p class="p">{{ dateValueFinishFormat }}</p></ion-label>
                    </ion-item>

                    <ion-list slot="content">
                      <ion-datetime style="width: 100%;" value="{{dateValueFinish}}" locale="pt-BR" #dateTimeFinish (ionChange)="dateChangeFinish(dateTimeFinish.value)" max="{{ maxDate }}" min={{dateValueInit}} presentation="date"></ion-datetime>
                    </ion-list>
                  </ion-accordion>
                  <ion-accordion value="dia" [ngStyle]="{'display': displayDay}">
                    <ion-item lines="none" color="secondary"slot="header">
                      <ion-label>Dia<p class="p">{{ dateValueDayFormat }}</p></ion-label>
                    </ion-item>

                    <ion-list slot="content">
                      <ion-datetime style="width: 100%;" value="{{dateValueDay}}" locale="pt-BR" #dateTimeDay (ionChange)="dateChangeDay(dateTimeDay.value)" max="{{ maxDate }}" presentation="date"></ion-datetime>
                    </ion-list>
                  </ion-accordion>
                </ion-accordion-group>
              </ion-list>
              <ion-button id="btnFilter" (click)="applyDateChanger(); dateTimeDay.confirm(true); dateTimeFinish.confirm(true); dateTimeInit.confirm(true);" expand="block" fill="clear" shape="round">
                Filtrar
              </ion-button>
            </ion-content>
          </ng-template>
        </ion-popover>
      </div>
      <ng-container *ngFor="let unidade of unidadesFat">
        <div *ngIf="!displayUnidades" class="unidade" [ngStyle]="{'display': unidadesCheck[unidade['nome_cc']]['display']}">
          <h2 >{{unidade['nome_cc']}}</h2>
          <ion-checkbox *ngIf="unidadesCheck[unidade['nome_cc']]['check'] === undefined"  [checked]="false" (ionChange)="unidadesChangeCheck($event['detail'].checked,unidade['nome_cc'])"></ion-checkbox>
          <ion-checkbox *ngIf="unidadesCheck[unidade['nome_cc']]['check'] !== undefined" [checked]="unidadesCheck[unidade['nome_cc']]['check']" (ionChange)="unidadesChangeCheck($event['detail'].checked,unidade['nome_cc'])"></ion-checkbox>
          <div class="dados">
            <div class="dado">
              <h3>faturamento:</h3>
              <p *ngIf="dateLoader">{{ convertInReal(unidade['somaFat']) }}</p>
              <ion-skeleton-text *ngIf="!dateLoader" animated style="width: 30%"></ion-skeleton-text>
            </div>
            <div class="dado">
              <h3 id="cmv">cmv:</h3>
              <p *ngIf="dateLoader && cmvPerc">{{unidade['cmv_vlr']}}{{perc}}</p>
              <p *ngIf="dateLoader && !cmvPerc">{{convertInReal(unidade['cmv_vlr'])}}{{perc}}</p>
              <ion-skeleton-text *ngIf="!dateLoader" animated style="width: 30%"></ion-skeleton-text>
            </div>
            <div class="dado">
              <h3>margem:</h3>
              <p *ngIf="dateLoader">{{ convertInReal(unidade['somaMargem']) }}</p>
              <ion-skeleton-text *ngIf="!dateLoader" animated style="width: 30%"></ion-skeleton-text>
            </div>
          </div>
        </div>
        <div *ngIf="displayUnidades" class="unidade" [ngStyle]="{'display': 'block'}">
          <h2 >{{unidade['nome_cc']}}</h2>
          <ion-checkbox *ngIf="unidadesCheck[unidade['nome_cc']]['check'] === undefined"  [checked]="false" (ionChange)="unidadesChangeCheck($event['detail'].checked,unidade['nome_cc'])"></ion-checkbox>
          <ion-checkbox *ngIf="unidadesCheck[unidade['nome_cc']]['check'] !== undefined" [checked]="unidadesCheck[unidade['nome_cc']]['check']" (ionChange)="unidadesChangeCheck($event['detail'].checked,unidade['nome_cc'])"></ion-checkbox>
          <div class="dados">
            <div class="dado">
              <h3>faturamento:</h3>
              <p *ngIf="dateLoader">{{ convertInReal(unidade['somaFat']) }}</p>
              <ion-skeleton-text *ngIf="!dateLoader" animated style="width: 30%"></ion-skeleton-text>
            </div>
            <div class="dado">
              <h3 id="cmv">cmv:</h3>
              <p *ngIf="dateLoader && cmvPerc">{{unidade['cmv_vlr']}}{{perc}}</p>
              <p *ngIf="dateLoader && !cmvPerc">{{convertInReal(unidade['cmv_vlr'])}}{{perc}}</p>
              <ion-skeleton-text *ngIf="!dateLoader" animated style="width: 30%"></ion-skeleton-text>
            </div>
            <div class="dado">
              <h3>margem:</h3>
              <p *ngIf="dateLoader">{{ convertInReal(unidade['somaMargem']) }}</p>
              <ion-skeleton-text *ngIf="!dateLoader" animated style="width: 30%"></ion-skeleton-text>
            </div>
          </div>
        </div>
      </ng-container>
      <div *ngIf="!contentLoader" class="unidade">
        <ion-skeleton-text color="dark" animated style="width: 70%; height: 19px;"></ion-skeleton-text>
        <div class="dados">
          <div class="dado">
            <h3>faturamento:</h3>
            <ion-skeleton-text animated style="width: 30%;"></ion-skeleton-text>
          </div>
          <div class="dado">
            <h3 id="cmv">cmv:</h3>
            <ion-skeleton-text animated style="width: 30%"></ion-skeleton-text>
          </div>
          <div class="dado">
            <h3>margem:</h3>
            <ion-skeleton-text animated style="width: 30%"></ion-skeleton-text>
          </div>
        </div>
      </div>
      <div *ngIf="contentLoader" id="totalUnid">
        <h2>total</h2>
        <div id="dadosTotal">
          <div class="dadoTotal">
            <h3>faturamento:</h3>
            <p *ngIf="dateLoader">{{ somaFatTotal }}</p>
            <ion-skeleton-text *ngIf="!dateLoader" animated style="width: 30%"></ion-skeleton-text>
          </div>
          <div class="dadoTotal">
            <h3>CMV:</h3>
            <p *ngIf="dateLoader">{{somaCMVTotal}}{{perc}}</p>
            <ion-skeleton-text *ngIf="!dateLoader" animated style="width: 30%"></ion-skeleton-text>
          </div>
          <div class="dadoTotal">
            <h3>margem:</h3>
            <p *ngIf="dateLoader">{{ somaMargemTotal }}</p>
            <ion-skeleton-text *ngIf="!dateLoader" animated style="width: 30%"></ion-skeleton-text>
          </div>
        </div>
      </div>
      <div *ngIf="!contentLoader" id="totalUnid">
        <h2>total</h2>
        <div id="dadosTotal">
          <div class="dadoTotal">
            <h3>faturamento:</h3>
            <ion-skeleton-text animated style="width: 30%"></ion-skeleton-text>
          </div>
          <div class="dadoTotal">
            <h3>CMV:</h3>
            <ion-skeleton-text animated style="width: 30%"></ion-skeleton-text>
          </div>
          <div class="dadoTotal">
            <h3>margem:</h3>
            <ion-skeleton-text animated style="width: 30%"></ion-skeleton-text>
          </div>
        </div>
      </div>
  </div>
</section>
</ion-content>
